"use strict";(self.webpackChunk_strapi_admin=self.webpackChunk_strapi_admin||[]).push([[3650],{40101:(ea,re,l)=>{l.r(re),l.d(re,{default:()=>Zt});var e=l(32735),De=l(99357),S=l(5636),g=l(88425),m=l(99214),oe=l(19615),N=l(5141),se=l(77997),R=l(11856),be=l(16540),A=l(44526),xe=l(59290),z=l.n(xe),W=l(9808),Re=l(27635),je=l(35980),Qe=l(28004),He=l(20763),j=l(95602),G=l(78330),K=l(19192),$e=l(95717),Ue=l.n($e),Ve=l(86588),Ze=l(61405),Ne=l(8639),ze=l(94553),We=l(90312),Ge=l(89581),Ke=l(37293),Je=l(77935),Xe=l(60216),y=l.n(Xe);const J=({pagination:n})=>e.createElement(W.Box,{paddingTop:6},e.createElement(K.Flex,{alignItems:"flex-end",justifyContent:"space-between"},e.createElement(g.PageSizeURLQuery,null),e.createElement(g.PaginationURLQuery,{pagination:n})));J.defaultProps={pagination:{pageCount:0,pageSize:10,total:0}},J.propTypes={pagination:y().shape({page:y().number,pageCount:y().number,pageSize:y().number,total:y().number})};var Ye=l(46891),X=l(84968),Q=l(74951),we=(n,t,a)=>new Promise((r,i)=>{var c=o=>{try{s(a.next(o))}catch(u){i(u)}},d=o=>{try{s(a.throw(o))}catch(u){i(u)}},s=o=>o.done?r(o.value):Promise.resolve(o.value).then(c,d);s((a=a.apply(n,t)).next())});const ke=(n,{enabled:t=!0})=>{const a=(0,g.useNotification)(),r=(0,m.IF)("folders"),i=()=>we(void 0,null,function*(){try{const{data:o}=yield m.be.get(`${r}/${n}?populate=parent`);return o.data}catch(o){throw a({type:"warning",message:{id:(0,m.OB)("notification.warning.404"),defaultMessage:"Not found"}}),o}}),{data:c,error:d,isLoading:s}=(0,X.useQuery)([Q.Z,"folder",n],i,{retry:!1,enabled:t,staleTime:0,cacheTime:0});return{data:c,error:d,isLoading:s}};var qe=l(1920),Y=l(90662),M=l(68781),_e=l(20069),et=l(76470),tt=l.n(et),at=l(81094),nt=(n,t,a)=>new Promise((r,i)=>{var c=o=>{try{s(a.next(o))}catch(u){i(u)}},d=o=>{try{s(a.throw(o))}catch(u){i(u)}},s=o=>o.done?r(o.value):Promise.resolve(o.value).then(c,d);s((a=a.apply(n,t)).next())});const ie=({selected:n,onSuccess:t})=>{const{formatMessage:a}=(0,S.useIntl)(),[r,i]=(0,e.useState)(!1),{isLoading:c,remove:d}=(0,at.K)(),s=()=>nt(void 0,null,function*(){yield d(n),t()});return e.createElement(e.Fragment,null,e.createElement(A.Button,{variant:"danger-light",size:"S",startIcon:e.createElement(tt(),null),onClick:()=>i(!0)},a({id:"global.delete",defaultMessage:"Delete"})),e.createElement(g.ConfirmDialog,{isConfirmButtonLoading:c,isOpen:r,onToggleDialog:()=>i(!1),onConfirm:s}))};ie.propTypes={selected:y().arrayOf(M.pw,M.nx).isRequired,onSuccess:y().func.isRequired};var lt=l(44474),rt=l.n(lt),ot=l(83281),st=l(86834),it=l.n(st),dt=l(82910),I=l(4122),ut=l(20001),ct=Object.defineProperty,mt=Object.defineProperties,ft=Object.getOwnPropertyDescriptors,de=Object.getOwnPropertySymbols,vt=Object.prototype.hasOwnProperty,gt=Object.prototype.propertyIsEnumerable,ue=(n,t,a)=>t in n?ct(n,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[t]=a,ce=(n,t)=>{for(var a in t||(t={}))vt.call(t,a)&&ue(n,a,t[a]);if(de)for(var a of de(t))gt.call(t,a)&&ue(n,a,t[a]);return n},me=(n,t)=>mt(n,ft(t));const pt=()=>{const n=(0,g.useNotification)(),t=(0,X.useQueryClient)(),a=(0,m.IF)("actions/bulk-move"),r=({destinationFolderId:d,filesAndFolders:s})=>{const o=s.reduce((u,O)=>{const{id:E,type:v}=O,h=v==="asset"?"fileIds":"folderIds";return u[h]||(u[h]=[]),u[h].push(E),u},{});return m.be.post(a,me(ce({},o),{destinationFolderId:d}))},i=(0,X.useMutation)(r,{onSuccess:d=>{var s;const{data:{data:o}}=d;((s=o==null?void 0:o.files)==null?void 0:s.length)>0&&(t.refetchQueries([Q.Z,"assets"],{active:!0}),t.refetchQueries([Q.Z,"asset-count"],{active:!0})),t.refetchQueries([Q.Z,"folders"],{active:!0}),n({type:"success",message:{id:(0,m.OB)("modal.move.success-label"),defaultMessage:"Elements have been moved successfully."}})}}),c=(d,s)=>i.mutateAsync({destinationFolderId:d,filesAndFolders:s});return me(ce({},i),{move:c})};var yt=l(82892),Et=l(72236),ht=(n,t,a)=>new Promise((r,i)=>{var c=o=>{try{s(a.next(o))}catch(u){i(u)}},d=o=>{try{s(a.throw(o))}catch(u){i(u)}},s=o=>o.done?r(o.value):Promise.resolve(o.value).then(c,d);s((a=a.apply(n,t)).next())});const w=({onClose:n,selected:t,currentFolder:a})=>{const{formatMessage:r}=(0,S.useIntl)(),{data:i,isLoading:c}=(0,Et.v)(),{move:d}=pt();if(!i)return null;const s=(O,E)=>ht(void 0,[O,E],function*(v,{setErrors:h}){try{yield d(v.destination.value,t),n()}catch(U){const p=(0,g.getAPIInnerErrors)(U,{getTrad:m.OB}),x=Object.entries(p).reduce((P,[F,ee])=>(P[F||"destination"]=ee.defaultMessage,P),{});it()(x)||h(x)}}),o=()=>{n()};if(c)return e.createElement(I.ModalLayout,{onClose:o,labelledBy:"title"},e.createElement(I.ModalBody,null,e.createElement(K.Flex,{justifyContent:"center",paddingTop:4,paddingBottom:4},e.createElement(dt.Loader,null,r({id:(0,m.OB)("list.asset.load"),defaultMessage:"Content is loading."})))));const u={destination:{value:(a==null?void 0:a.id)||"",label:(a==null?void 0:a.name)||i[0].label}};return e.createElement(I.ModalLayout,{onClose:o,labelledBy:"title"},e.createElement(ot.Formik,{validateOnChange:!1,onSubmit:s,initialValues:u},({values:O,errors:E,setFieldValue:v})=>e.createElement(g.Form,{noValidate:!0},e.createElement(I.ModalHeader,null,e.createElement(j.Typography,{fontWeight:"bold",textColor:"neutral800",as:"h2",id:"title"},r({id:(0,m.OB)("modal.folder.move.title"),defaultMessage:"Move elements to"}))),e.createElement(I.ModalBody,null,e.createElement(G.Grid,{gap:4},e.createElement(G.GridItem,{xs:12,col:12},e.createElement(Y.Stack,{spacing:1},e.createElement(ut.FieldLabel,{htmlFor:"folder-destination"},r({id:(0,m.OB)("form.input.label.folder-location"),defaultMessage:"Location"})),e.createElement(yt.Z,{options:i,onChange:h=>{v("destination",h)},defaultValue:O.destination,name:"destination",menuPortalTarget:document.querySelector("body"),inputId:"folder-destination",error:E==null?void 0:E.destination,ariaErrorMessage:"destination-error"}),E.destination&&e.createElement(j.Typography,{variant:"pi",as:"p",id:"folder-destination-error",textColor:"danger600"},E.destination))))),e.createElement(I.ModalFooter,{startActions:e.createElement(A.Button,{onClick:o,variant:"tertiary",name:"cancel"},r({id:"cancel",defaultMessage:"Cancel"})),endActions:e.createElement(A.Button,{type:"submit",loading:c},r({id:"modal.folder.move.submit",defaultMessage:"Move"}))}))))};w.defaultProps={currentFolder:void 0},w.propTypes={onClose:y().func.isRequired,currentFolder:M.nx,selected:y().arrayOf(M.nx,M.pw).isRequired};const k=({selected:n,onSuccess:t,currentFolder:a})=>{const{formatMessage:r}=(0,S.useIntl)(),[i,c]=(0,e.useState)(!1),d=()=>{c(!1),t()};return e.createElement(e.Fragment,null,e.createElement(A.Button,{variant:"secondary",size:"S",startIcon:e.createElement(rt(),null),onClick:()=>c(!0)},r({id:"global.move",defaultMessage:"Move"})),i&&e.createElement(w,{currentFolder:a,onClose:d,selected:n}))};k.defaultProps={currentFolder:void 0},k.propTypes={onSuccess:y().func.isRequired,currentFolder:M.nx,selected:y().arrayOf(M.pw,M.nx).isRequired};const q=({selected:n,onSuccess:t,currentFolder:a})=>{const{formatMessage:r}=(0,S.useIntl)();return e.createElement(Y.Stack,{horizontal:!0,spacing:2,paddingBottom:5},e.createElement(j.Typography,{variant:"epsilon",textColor:"neutral600"},r({id:(0,_e.Z)("list.assets.selected"),defaultMessage:"{numberFolders, plural, one {1 folder} other {# folders}} - {numberAssets, plural, one {1 asset} other {# assets}} selected"},{numberFolders:n.filter(({type:i})=>i==="folder").length,numberAssets:n.filter(({type:i})=>i==="asset").length})),e.createElement(ie,{selected:n,onSuccess:t}),e.createElement(k,{currentFolder:a,selected:n,onSuccess:t}))};q.defaultProps={currentFolder:void 0},q.propTypes={onSuccess:y().func.isRequired,currentFolder:M.nx,selected:y().arrayOf(M.pw,M.nx).isRequired};var H=l(47359),Mt=l(23899),Ot=l.n(Mt),Ft=l(79996),Pt=l(90768),fe=l(90142);const Bt=()=>{var n;const t=(0,e.useRef)(null),[a,r]=(0,e.useState)(!1),{formatMessage:i}=(0,S.useIntl)(),{trackUsage:c}=(0,g.useTracking)(),[{query:d},s]=(0,g.useQueryParams)(),o=((n=d==null?void 0:d.filters)==null?void 0:n.$and)||[],u=()=>r(v=>!v),O=v=>{s({filters:{$and:v},page:1})},E=v=>{c("didFilterMediaLibraryElements",{location:"content-manager",filter:Object.keys(v[v.length-1])[0]}),s({filters:{$and:v},page:1})};return e.createElement(e.Fragment,null,e.createElement(A.Button,{variant:"tertiary",ref:t,startIcon:e.createElement(Ot(),null),onClick:u,size:"S"},i({id:"app.utils.filters",defaultMessage:"Filters"})),a&&e.createElement(Pt.Z,{displayedFilters:fe.Z,filters:o,onSubmit:E,onToggle:u,source:t}),e.createElement(Ft.Z,{appliedFilters:o,filtersSchema:fe.Z,onRemoveFilter:O}))};var Ct=l(58434),Lt=l(98599),St=l.n(Lt),At=Object.defineProperty,It=Object.defineProperties,Tt=Object.getOwnPropertyDescriptors,ve=Object.getOwnPropertySymbols,Dt=Object.prototype.hasOwnProperty,bt=Object.prototype.propertyIsEnumerable,ge=(n,t,a)=>t in n?At(n,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[t]=a,xt=(n,t)=>{for(var a in t||(t={}))Dt.call(t,a)&&ge(n,a,t[a]);if(ve)for(var a of ve(t))bt.call(t,a)&&ge(n,a,t[a]);return n},Rt=(n,t)=>It(n,Tt(t));const _=({canCreate:n,onToggleEditFolderDialog:t,onToggleUploadAssetDialog:a,folder:r,assetCount:i,folderCount:c})=>{var d,s,o;const{formatMessage:u}=(0,S.useIntl)(),{pathname:O}=(0,N.useLocation)(),[{query:E}]=(0,g.useQueryParams)(),v=Rt(xt({},E),{folder:(s=(d=r==null?void 0:r.parent)==null?void 0:d.id)!=null?s:void 0}),h=((o=r==null?void 0:r.name)==null?void 0:o.length)>30?`${r.name.slice(0,30)}...`:r==null?void 0:r.name;return e.createElement(R.HeaderLayout,{title:`${u({id:(0,m.OB)("plugin.name"),defaultMessage:"Media Library"})}${h?` - ${h}`:""}`,subtitle:u({id:(0,m.OB)("header.content.assets"),defaultMessage:"{numberFolders, plural, one {1 folder} other {# folders}} - {numberAssets, plural, one {1 asset} other {# assets}}"},{numberAssets:i,numberFolders:c}),navigationAction:r&&e.createElement(Ct.Link,{startIcon:e.createElement(St(),null),to:`${O}?${(0,se.stringify)(v,{encode:!1})}`},u({id:(0,m.OB)("header.actions.folder-level-up"),defaultMessage:"Back"})),primaryAction:n&&e.createElement(Y.Stack,{horizontal:!0,spacing:2},e.createElement(A.Button,{startIcon:e.createElement(z(),null),variant:"secondary",onClick:t},u({id:(0,m.OB)("header.actions.add-folder"),defaultMessage:"Add new folder"})),e.createElement(A.Button,{startIcon:e.createElement(z(),null),onClick:a},u({id:(0,m.OB)("header.actions.add-assets"),defaultMessage:"Add new assets"})))})};_.defaultProps={folder:null},_.propTypes={assetCount:y().number.isRequired,canCreate:y().bool.isRequired,folder:M.nx,folderCount:y().number.isRequired,onToggleEditFolderDialog:y().func.isRequired,onToggleUploadAssetDialog:y().func.isRequired};var jt=Object.defineProperty,Qt=Object.defineProperties,Ht=Object.getOwnPropertyDescriptors,$=Object.getOwnPropertySymbols,pe=Object.prototype.hasOwnProperty,ye=Object.prototype.propertyIsEnumerable,Ee=(n,t,a)=>t in n?jt(n,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[t]=a,D=(n,t)=>{for(var a in t||(t={}))pe.call(t,a)&&Ee(n,a,t[a]);if($)for(var a of $(t))ye.call(t,a)&&Ee(n,a,t[a]);return n},b=(n,t)=>Qt(n,Ht(t)),$t=(n,t)=>{var a={};for(var r in n)pe.call(n,r)&&t.indexOf(r)<0&&(a[r]=n[r]);if(n!=null&&$)for(var r of $(n))t.indexOf(r)<0&&ye.call(n,r)&&(a[r]=n[r]);return a};const Ut=(0,oe.default)(W.Box)`
  height: ${32/16}rem;
  display: flex;
  align-items: center;
`,he=(0,oe.default)(j.Typography)`
  max-width: 100%;
`,Vt=()=>{var n,t,a,r;const{push:i}=(0,N.useHistory)(),{canRead:c,canCreate:d,canUpdate:s,canCopyLink:o,canDownload:u,isLoading:O}=(0,Ye.y)(),E=(0,e.useRef)(),{formatMessage:v}=(0,S.useIntl)(),{pathname:h}=(0,N.useLocation)(),{trackUsage:U}=(0,g.useTracking)(),[{query:p},x]=(0,g.useQueryParams)(),P=Boolean(p._q||p.filters),{data:F,isLoading:ee,errors:Nt}=(0,Ke.L)({skipWhen:!c,query:p}),{data:V,isLoading:zt,errors:Wt}=(0,Je.j)({enabled:c&&((n=F==null?void 0:F.pagination)==null?void 0:n.page)===1&&!(0,m.rV)(p),query:p}),{data:Me,isLoading:Gt,error:Oe}=ke(p==null?void 0:p.folder,{enabled:c&&!!(p!=null&&p.folder)});((t=Oe==null?void 0:Oe.response)==null?void 0:t.status)===404&&i(h);const B=(V==null?void 0:V.length)||0,Z=F==null?void 0:F.results,C=(a=Z==null?void 0:Z.length)!=null?a:0,Fe=Gt||zt||O||ee,[Kt,Jt]=(0,e.useState)(!1),[Xt,Pe]=(0,e.useState)(!1),[Be,Ce]=(0,e.useState)(void 0),[te,Le]=(0,e.useState)(void 0),[L,{selectOne:ae,selectAll:Se}]=(0,g.useSelectionState)(["type","id"],[]),ne=()=>Jt(f=>!f),Ae=({created:f=!1}={})=>{f&&(p==null?void 0:p.page)!=="1"&&x(b(D({},p),{page:1})),Pe(T=>!T)},Yt=f=>{U("didSortMediaLibraryElements",{location:"upload",sort:f}),x({sort:f})},wt=f=>{Le(f),Pe(!0)},kt=f=>{Le(null),Ae(f),E.current&&E.current.focus()};return(0,g.useFocusWhenNavigate)(),e.createElement(R.Layout,null,e.createElement(be.Main,{"aria-busy":Fe},e.createElement(_,{assetCount:C,folderCount:B,canCreate:d,onToggleEditFolderDialog:Ae,onToggleUploadAssetDialog:ne,folder:Me}),e.createElement(R.ActionLayout,{startActions:e.createElement(e.Fragment,null,s&&(C>0||B>0)&&e.createElement(Ut,{paddingLeft:2,paddingRight:2,background:"neutral0",hasRadius:!0,borderColor:"neutral200"},e.createElement(je.BaseCheckbox,{"aria-label":v({id:(0,m.OB)("bulk.select.label"),defaultMessage:"Select all folders & assets"}),indeterminate:(L==null?void 0:L.length)>0&&(L==null?void 0:L.length)!==C+B,value:(C>0||B>0)&&L.length===C+B,onChange:f=>{f.target.checked&&U("didSelectAllMediaLibraryElements"),Se([...Z.map(T=>b(D({},T),{type:"asset"})),...V.map(T=>b(D({},T),{type:"folder"}))])}})),c&&e.createElement(Ge.Z,{onChangeSort:Yt}),c&&e.createElement(Bt,null)),endActions:e.createElement(g.SearchURLQuery,{label:v({id:(0,m.OB)("search.label"),defaultMessage:"Search for an asset"}),trackedEvent:"didSearchMediaLibraryElements",trackedEventDetails:{location:"upload"}})}),e.createElement(R.ContentLayout,null,L.length>0&&e.createElement(q,{currentFolder:Me,selected:L,onSuccess:Se}),Fe&&e.createElement(g.LoadingIndicatorPage,null),(Nt||Wt)&&e.createElement(g.AnErrorOccurred,null),B===0&&C===0&&e.createElement(qe.i,{action:d&&!P&&e.createElement(A.Button,{variant:"secondary",startIcon:e.createElement(z(),null),onClick:ne},v({id:(0,m.OB)("header.actions.add-assets"),defaultMessage:"Add new assets"})),content:v(P?{id:(0,m.OB)("list.assets-empty.title-withSearch"),defaultMessage:"There are no elements with the applied filters"}:d?{id:(0,m.OB)("list.assets.empty"),defaultMessage:"Upload your first assets..."}:{id:(0,m.OB)("list.assets.empty.no-permissions"),defaultMessage:"The asset list is empty"})}),c?e.createElement(e.Fragment,null,B>0&&e.createElement(We.$,{title:(P&&C>0||!P)&&v({id:(0,m.OB)("list.folders.title"),defaultMessage:"Folders"})||""},V.map(f=>{const qt=!!L.filter(({type:le})=>le==="folder").find(le=>le.id===f.id),Ie=p,{_q:aa}=Ie,_t=$t(Ie,["_q"]),Te=`${h}?${(0,se.stringify)(b(D({},_t),{folder:f.id}))}`;return e.createElement(G.GridItem,{col:3,key:`folder-${f.id}`},e.createElement(H.Ac,{ref:te&&f.id===te.id?E:void 0,ariaLabel:f.name,id:`folder-${f.id}`,to:Te,startAction:ae&&e.createElement(H.MM,{"data-testid":`folder-checkbox-${f.id}`,value:qt,onChange:()=>ae(b(D({},f),{type:"folder"}))}),cardActions:e.createElement(He.IconButton,{icon:e.createElement(Ue(),null),"aria-label":v({id:(0,m.OB)("list.folder.edit"),defaultMessage:"Edit folder"}),onClick:()=>wt(f)})},e.createElement(H.Bu,null,e.createElement(H.u6,{to:Te},e.createElement(K.Flex,{as:"h2",direction:"column",alignItems:"start",maxWidth:"100%"},e.createElement(he,{fontWeight:"semiBold",ellipsis:!0},f.name,e.createElement(Qe.VisuallyHidden,null,":")),e.createElement(he,{as:"span",textColor:"neutral600",variant:"pi",ellipsis:!0},v({id:(0,m.OB)("list.folder.subtitle"),defaultMessage:"{folderCount, plural, =0 {# folder} one {# folder} other {# folders}}, {filesCount, plural, =0 {# asset} one {# asset} other {# assets}}"},{folderCount:f.children.count,filesCount:f.files.count})))))))})),C>0&&B>0&&e.createElement(W.Box,{paddingTop:6,paddingBottom:4},e.createElement(Re.Divider,null)),C>0&&e.createElement(e.Fragment,null,e.createElement(ze.l,{assets:Z,onEditAsset:Ce,onSelectAsset:ae,selectedAssets:L.filter(({type:f})=>f==="asset"),title:(!P||P&&B>0)&&((r=F==null?void 0:F.pagination)==null?void 0:r.page)===1&&v({id:(0,m.OB)("list.assets.title"),defaultMessage:"Assets"})||""}),(F==null?void 0:F.pagination)&&e.createElement(J,{pagination:F.pagination}))):e.createElement(g.NoPermissions,null))),Kt&&e.createElement(Ve.x,{onClose:ne,trackedLocation:"upload",folderId:p==null?void 0:p.folder}),Xt&&e.createElement(Ze.f,{onClose:kt,folder:te,parentFolderId:p==null?void 0:p.folder,location:"upload"}),Be&&e.createElement(Ne.s,{onClose:()=>Ce(void 0),asset:Be,canUpdate:s,canCopyLink:o,canDownload:u,trackedLocation:"upload"}))},Zt=()=>{const[{rawQuery:n},t]=(0,g.useQueryParams)(),{formatMessage:a}=(0,S.useIntl)(),r=a({id:(0,m.OB)("plugin.name"),defaultMessage:"Media Library"});return(0,e.useEffect)(()=>{n||t({sort:"updatedAt:DESC",page:1,pageSize:10})},[n,t]),n?e.createElement(e.Fragment,null,e.createElement(De.Helmet,{title:r}),e.createElement(Vt,null)):null}}}]);
