"use strict";(self.webpackChunk_strapi_admin=self.webpackChunk_strapi_admin||[]).push([[4263],{40874:(b,P,e)=>{e.r(P),e.d(P,{default:()=>ye});var t=e(32735),s=e(88425),o=e(5141),p=e(92891),C=e(83983),l=e(41925),_=e(52136),i=e(72142),M=e.n(i),c=e(5636),D=e(60216),L=e.n(D),V=e(88423),S=e.n(V),F=e(33795),Z=e.n(F),G=e(9086),z=e.n(G),I=e(84968),x=e(83281),E=e(9808),O=e(44526),u=e(78330),A=e(11856),U=e(95602),X=e(16540),g=e(90662),n=e(98599),a=e.n(n),r=e(88677),q=e.n(r),Y=e(7602),B=e(17247),re=(R,W,m)=>new Promise((H,d)=>{var Q=K=>{try{w(m.next(K))}catch(J){d(J)}},N=K=>{try{w(m.throw(K))}catch(J){d(J)}},w=K=>K.done?H(K.value):Promise.resolve(K.value).then(Q,N);w((m=m.apply(R,W)).next())});const Ee=R=>re(void 0,null,function*(){const{data:W}=yield B.be.get(`/admin/users/${R}`);return W.data}),ge=(R,W)=>re(void 0,null,function*(){const{data:m}=yield B.be.put(`/admin/users/${R}`,W);return m.data}),fe=[[{intlLabel:{id:"Auth.form.firstname.label",defaultMessage:"First name"},name:"firstname",placeholder:{id:"Auth.form.firstname.placeholder",defaultMessage:"e.g. Kai"},type:"text",size:{col:6,xs:12},required:!0},{intlLabel:{id:"Auth.form.lastname.label",defaultMessage:"Last name"},name:"lastname",placeholder:{id:"Auth.form.lastname.placeholder",defaultMessage:"e.g. Doe"},type:"text",size:{col:6,xs:12}}],[{intlLabel:{id:"Auth.form.email.label",defaultMessage:"Email"},name:"email",placeholder:{id:"Auth.form.email.placeholder",defaultMessage:"e.g. kai.doe@strapi.io"},type:"email",size:{col:6,xs:12},required:!0},{intlLabel:{id:"Auth.form.username.label",defaultMessage:"Username"},name:"username",placeholder:{id:"Auth.form.username.placeholder",defaultMessage:"e.g. Kai_Doe"},type:"text",size:{col:6,xs:12}}],[{intlLabel:{id:"global.password",defaultMessage:"Password"},name:"password",type:"password",size:{col:6,xs:12},autoComplete:"new-password"},{intlLabel:{id:"Auth.form.confirmPassword.label",defaultMessage:"Password confirmation"},name:"confirmPassword",type:"password",size:{col:6,xs:12},autoComplete:"new-password"}],[{intlLabel:{id:"Auth.form.active.label",defaultMessage:"Active"},name:"isActive",type:"bool",size:{col:6,xs:12}}]];var ve=e(1057),Pe=e(4397),Me=e(98399),Oe=function(){return window&&window.strapi&&window.strapi.isEE?e(28890).Z:e(16325).Z}(),ne=["email","firstname","lastname","username","isActive","roles"],oe=function(W){var m=W.canUpdate,H=(0,c.useIntl)(),d=H.formatMessage,Q=(0,o.useRouteMatch)("/settings/users/:id"),N=Q.params.id,w=(0,o.useHistory)(),K=w.push,J=(0,s.useAppInfos)(),De=J.setUserDisplayName,ae=(0,s.useNotification)(),le=(0,s.useOverlayBlocker)(),Le=le.lockApp,Ae=le.unlockApp;(0,s.useFocusWhenNavigate)();var ie=(0,I.useQuery)(["user",N],function(){return Ee(N)},{retry:!1,keepPreviousData:!1,staleTime:1e3*20,onError:function(f){var v=f.response.status;v===403&&(ae({type:"info",message:{id:"notification.permission.not-allowed-read",defaultMessage:"You are not allowed to see this document"}}),K("/")),Me.log(f.response.status)}}),Te=ie.status,T=ie.data,Ce=function(){var h=(0,_.Z)(M().mark(function f(v,$){var k,te,j,se,ue;return M().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return Le(),y.prev=1,y.next=4,ge(N,z()(v,"confirmPassword"));case 4:k=y.sent,ae({type:"success",message:d({id:"notification.success.saved",defaultMessage:"Saved"})}),te=s.auth.getUserInfo(),N.toString()===te.id.toString()&&(s.auth.setUserInfo(k),j=Z()(v,"username")||(0,Y.Pp)(v.firstname,v.lastname),De(j)),$.setValues(S()(v,ne)),y.next=17;break;case 11:y.prev=11,y.t0=y.catch(1),se=(0,Y.Iz)(y.t0.response.data),ue=Object.keys(se).reduce(function(me,pe){return me[pe]=se[pe].id,me},{}),$.setErrors(ue),ae({type:"warning",message:Z()(y.t0,"response.data.message","notification.error")});case 17:Ae();case 18:case"end":return y.stop()}},f,null,[[1,11]])}));return function(v,$){return h.apply(this,arguments)}}(),de=Te!=="success",_e=de?{id:"app.containers.Users.EditPage.header.label-loading",defaultMessage:"Edit user"}:{id:"app.containers.Users.EditPage.header.label",defaultMessage:"Edit {name}"},ee=Object.keys(S()(T,ne)).reduce(function(h,f){return f==="roles"?(h[f]=((T==null?void 0:T.roles)||[]).map(function(v){var $=v.id;return $}),h):(h[f]=T==null?void 0:T[f],h)},{}),Ie=ee.username||(0,Y.Pp)(ee.firstname,ee.lastname),ce=d(_e,{name:Ie});return de?t.createElement(X.Main,{"aria-busy":"true"},t.createElement(s.SettingsPageTitle,{name:"Users"}),t.createElement(A.HeaderLayout,{primaryAction:t.createElement(O.Button,{disabled:!0,startIcon:t.createElement(q(),null),type:"button",size:"L"},d({id:"global.save",defaultMessage:"Save"})),title:ce,navigationAction:t.createElement(s.Link,{startIcon:t.createElement(a(),null),to:"/settings/users?pageSize=10&page=1&sort=firstname"},d({id:"global.back",defaultMessage:"Back"}))}),t.createElement(A.ContentLayout,null,t.createElement(s.LoadingIndicatorPage,null))):t.createElement(X.Main,null,t.createElement(s.SettingsPageTitle,{name:"Users"}),t.createElement(x.Formik,{onSubmit:Ce,initialValues:ee,validateOnChange:!1,validationSchema:ve.YM},function(h){var f=h.errors,v=h.values,$=h.handleChange,k=h.isSubmitting;return t.createElement(s.Form,null,t.createElement(A.HeaderLayout,{primaryAction:t.createElement(O.Button,{disabled:k||!m,startIcon:t.createElement(q(),null),loading:k,type:"submit",size:"L"},d({id:"global.save",defaultMessage:"Save"})),title:ce,navigationAction:t.createElement(s.Link,{startIcon:t.createElement(a(),null),to:"/settings/users?pageSize=10&page=1&sort=firstname"},d({id:"global.back",defaultMessage:"Back"}))}),t.createElement(A.ContentLayout,null,(T==null?void 0:T.registrationToken)&&t.createElement(E.Box,{paddingBottom:6},t.createElement(Oe,{registrationToken:T.registrationToken})),t.createElement(g.Stack,{spacing:7},t.createElement(E.Box,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},t.createElement(g.Stack,{spacing:4},t.createElement(U.Typography,{variant:"delta",as:"h2"},d({id:"app.components.Users.ModalCreateBody.block-title.details",defaultMessage:"Details"})),t.createElement(u.Grid,{gap:5},fe.map(function(te){return te.map(function(j){return t.createElement(u.GridItem,(0,l.Z)({key:j.name},j.size),t.createElement(s.GenericInput,(0,l.Z)({},j,{disabled:!m,error:f[j.name],onChange:$,value:v[j.name]||""})))})})))),t.createElement(E.Box,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},t.createElement(g.Stack,{spacing:4},t.createElement(U.Typography,{variant:"delta",as:"h2"},d({id:"global.roles",defaultMessage:"User's role"})),t.createElement(u.Grid,{gap:5},t.createElement(u.GridItem,{col:6,xs:12},t.createElement(Pe.Z,{disabled:!m,error:f.roles,onChange:$,value:v.roles}))))))))}))};oe.propTypes={canUpdate:L().bool.isRequired};const he=oe,ye=()=>{const R=(0,s.useNotification)(),W=(0,t.useMemo)(()=>({read:C.Z.settings.users.read,update:C.Z.settings.users.update}),[]),{isLoading:m,allowedActions:{canRead:H,canUpdate:d}}=(0,s.useRBAC)(W),{state:Q}=(0,o.useLocation)(),N=(0,p.get)(Q,"from","/");return(0,t.useEffect)(()=>{m||!H&&!d&&R({type:"info",message:{id:"notification.permission.not-allowed-read",defaultMessage:"You are not allowed to see this document"}})},[m,H,d,R]),m?t.createElement(s.LoadingIndicatorPage,null):!H&&!d?t.createElement(o.Redirect,{to:N}):t.createElement(he,{canUpdate:d})}},76779:(b,P,e)=>{e.d(P,{Z:()=>Z});var t=e(32735),s=e(60216),o=e.n(s),p=e(20763),C=e.n(p),l=e(88425),_=e.n(l),i=e(68192),M=e.n(i),c=e(59087),D=e.n(c),L=e(5636),V=e.n(L);const S=()=>t.createElement("svg",{xmlns:"http://www.w3.org/2000/svg"},t.createElement("text",{transform:"translate(-23 -9)",fill:"#4B515A",fillRule:"evenodd",fontSize:"32",fontFamily:"AppleColorEmoji, Apple Color Emoji"},t.createElement("tspan",{x:"23",y:"36"},"\u2709\uFE0F"))),F=({children:G,target:z})=>{const I=(0,l.useNotification)(),{formatMessage:x}=(0,L.useIntl)(),E=()=>{I({type:"info",message:{id:"notification.link-copied"}})},O=x({id:"app.component.CopyToClipboard.label",defaultMessage:"Copy to clipboard"});return t.createElement(l.ContentBox,{endAction:t.createElement(c.CopyToClipboard,{onCopy:E,text:z},t.createElement(p.IconButton,{label:O,noBorder:!0,icon:t.createElement(M(),null)})),title:z,titleEllipsis:!0,subtitle:G,icon:t.createElement(S,null),iconBackground:"neutral100"})};F.propTypes={children:o().oneOfType([o().element,o().string]).isRequired,target:o().string.isRequired};const Z=F},16325:(b,P,e)=>{e.d(P,{Z:()=>M});var t=e(32735),s=e(5636),o=e.n(s),p=e(60216),C=e.n(p),l=e(463),_=e(76779);const i=({registrationToken:c})=>{const{formatMessage:D}=(0,s.useIntl)(),L=`${window.location.origin}${l.Z}auth/register?registrationToken=${c}`;return t.createElement(_.Z,{target:L},D({id:"app.components.Users.MagicLink.connect",defaultMessage:"Copy and share this link to give access to this user"}))};i.defaultProps={registrationToken:""},i.propTypes={registrationToken:C().string};const M=i},4397:(b,P,e)=>{e.d(P,{Z:()=>x});var t=e(32735),s=e(60216),o=e.n(s),p=e(5636),C=e.n(p),l=e(25716),_=e.n(l),i=e(84968),M=e.n(i),c=e(19615),D=e(103),L=e.n(D),V=e(17247),S=(E,O,u)=>new Promise((A,U)=>{var X=a=>{try{n(u.next(a))}catch(r){U(r)}},g=a=>{try{n(u.throw(a))}catch(r){U(r)}},n=a=>a.done?A(a.value):Promise.resolve(a.value).then(X,g);n((u=u.apply(E,O)).next())});const F=c.keyframes`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(359deg);
  }
`,Z=c.default.div`
  animation: ${F} 2s infinite linear;
`,G=()=>t.createElement(Z,null,t.createElement(L(),null)),z=()=>S(void 0,null,function*(){const{data:E}=yield V.be.get("/admin/roles");return E.data}),I=({disabled:E,error:O,onChange:u,value:A})=>{const{status:U,data:X}=(0,i.useQuery)(["roles"],z,{staleTime:5e4}),{formatMessage:g}=(0,p.useIntl)(),n=O?g({id:O,defaultMessage:O}):"",a=g({id:"app.components.Users.ModalCreateBody.block-title.roles",defaultMessage:"User's roles"}),r=g({id:"app.components.Users.ModalCreateBody.block-title.roles.description",defaultMessage:"A user can have one or several roles"}),q=g({id:"app.components.Select.placeholder",defaultMessage:"Select"}),Y=U==="loading"?t.createElement(G,null):void 0;return t.createElement(l.Select,{id:"roles",disabled:E,error:n,hint:r,label:a,name:"roles",onChange:B=>{u({target:{name:"roles",value:B}})},placeholder:q,multi:!0,startIcon:Y,value:A,withTags:!0,required:!0},(X||[]).map(B=>t.createElement(l.Option,{key:B.id,value:B.id},g({id:`global.${B.code}`,defaultMessage:B.name}))))};I.defaultProps={disabled:!1,error:void 0},I.propTypes={disabled:o().bool,error:o().string,onChange:o().func.isRequired,value:o().array.isRequired};const x=I},1057:(b,P,e)=>{e.d(P,{YM:()=>g,Rw:()=>S});var t=e(5173),s=e(88425),o=Object.defineProperty,p=Object.defineProperties,C=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,_=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,M=(n,a,r)=>a in n?o(n,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[a]=r,c=(n,a)=>{for(var r in a||(a={}))_.call(a,r)&&M(n,r,a[r]);if(l)for(var r of l(a))i.call(a,r)&&M(n,r,a[r]);return n},D=(n,a)=>p(n,C(a));const L={firstname:t.nK().required(s.translatedErrors.required),lastname:t.nK(),email:t.Z_().email(s.translatedErrors.email).lowercase().required(s.translatedErrors.required),username:t.Z_().nullable(),password:t.Z_().min(8,s.translatedErrors.minLength).matches(/[a-z]/,"components.Input.error.contain.lowercase").matches(/[A-Z]/,"components.Input.error.contain.uppercase").matches(/\d/,"components.Input.error.contain.number"),confirmPassword:t.Z_().min(8,s.translatedErrors.minLength).oneOf([t.iH("password"),null],"components.Input.error.password.noMatch").when("password",(n,a)=>n?a.required(s.translatedErrors.required):a)},S=D(c({},L),{currentPassword:t.Z_().when(["password","confirmPassword"],(n,a,r)=>n||a?r.required(s.translatedErrors.required):r),preferedLanguage:t.Z_().nullable()}),Z={roles:t.IX().min(1,s.translatedErrors.required).required(s.translatedErrors.required)};var G=Object.defineProperty,z=Object.defineProperties,I=Object.getOwnPropertyDescriptors,x=Object.getOwnPropertySymbols,E=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable,u=(n,a,r)=>a in n?G(n,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[a]=r,A=(n,a)=>{for(var r in a||(a={}))E.call(a,r)&&u(n,r,a[r]);if(x)for(var r of x(a))O.call(a,r)&&u(n,r,a[r]);return n},U=(n,a)=>z(n,I(a));const g=t.Ry().shape(A(U(A({},L),{isActive:t.Xg()}),Z))},28890:(b,P,e)=>{e.d(P,{Z:()=>M});var t=e(32735),s=e(5636),o=e.n(s),p=e(60216),C=e.n(p),l=e(463),_=e(76779);const i=({registrationToken:c})=>{const{formatMessage:D}=(0,s.useIntl)();return c?t.createElement(_.Z,{target:`${window.location.origin}${l.Z}auth/register?registrationToken=${c}`},D({id:"app.components.Users.MagicLink.connect",defaultMessage:"Copy and share this link to give access to this user"})):t.createElement(_.Z,{target:`${window.location.origin}${l.Z}auth/login`},D({id:"app.components.Users.MagicLink.connect.sso",defaultMessage:"Send this link to the user, the first login can be made via a SSO provider."}))};i.defaultProps={registrationToken:""},i.propTypes={registrationToken:C().string};const M=i}}]);
